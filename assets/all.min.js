jQuery(document).ready((function($){var t_img;$("photos img").each((function(){var _a=$("<a></a>").attr("href",this.src);$(this).wrap("<div class='photo'></div>").wrap(_a)})),isImgLoad((function(){var photos=document.querySelector("photos");photos&&waterfall(photos),$(window).resize((function(){photos&&waterfall(photos)}))}));var isLoad=!0;function isImgLoad(callback){$("photos img").each((function(){if(0===this.height)return isLoad=!1,!1})),isLoad?(clearTimeout(t_img),callback()):(isLoad=!0,t_img=setTimeout((function(){isImgLoad(callback)}),500))}})),jQuery(document).ready((function($){$(".post-content img:not(.avatar)").each((function(){var _b=$("<a></a>").attr("href",this.src);$(this).wrap(_b)})),$(".post-content a[rel!=link]:has(img)").slimbox(),$.lately({target:".post-date"});var nav=$(".tocify");if(nav.length>0){nav.removeClass("hide");var navTop=$(".post-content").offset().top,w=$(window).width()/2+400;nav.css("left",w),nav.css("top",navTop),$(window).scroll((function(){var scrolls;$(this).scrollTop()>navTop?nav.css({top:0,position:"fixed"}):nav.css({top:navTop,position:"absolute"})}))}var parse_url=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/,location_href=window.location.href.replace(parse_url,"$3");function moiveShow(_this,ls_item){var storage=localStorage.getItem(ls_item),data=JSON.parse(storage),str=_this.attr("href"),db_star=Math.ceil(data.rating);$("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><h4 class='post-preview--title'><a target='_blank' href='"+str+"'>《"+data.title+"》</a></h4><div class='rating'><div class='rating-star allstar"+db_star+"'></div><div class='rating-average'>"+data.rating+"</div></div><time class='post-preview--date'>导演："+data.directors+" / 类型："+data.genres+" / "+data.pubdate+"</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>"+data.intro+"</section></div></div><img loading='lazy' class='post-preview--image' src="+data.cover+"></div>").replaceAll(_this)}function bookShow(_this,ls_item){var storage=localStorage.getItem(ls_item),data=JSON.parse(storage),str=_this.attr("href"),db_star=Math.ceil(data.rating);$("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><h4 class='post-preview--title'><a target='_blank' href='"+str+"'>《"+data.title+"》</a></h4><div class='rating'><div class='rating-star allstar"+db_star+"'></div><div class='rating-average'>"+data.rating+"</div></div><time class='post-preview--date'>作者："+data.author+" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>"+data.intro+"</section></div></div><img loading='lazy' class='post-preview--image' src="+data.cover+"></div>").replaceAll(_this)}$(".post-content a:not(:has(img)),.author-name a,.links-item a,a.read-more").hover((function(){var this_href=$(this).attr("href"),replace_href=this_href.replace(parse_url,"$3");this_href!=replace_href&&location_href!=replace_href&&$(this).attr("target","_blank")})),$(".post-content a[href*='douban.com/subject/']").each((function(){var _this=$(this),str=_this.attr("href"),db_reg=/^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;if(db_reg.test(str)){var db_type=str.replace(db_reg,"$1"),db_id=str.replace(db_reg,"$2").toString(),db_api="https://bm.weajs.com/api/";if("movie"==db_type){var ls_item="movie"+db_id,url=db_api+"movies/"+db_id+"/";null==localStorage.getItem(ls_item)||"undefined"==localStorage.getItem(ls_item)?$.ajax({url:url,type:"GET",dataType:"json",success:function(data){localStorage.setItem(ls_item,JSON.stringify(data)),moiveShow(_this,ls_item)}}):moiveShow(_this,ls_item)}else if("book"==db_type){var ls_item="book"+db_id,url=db_api+"books/"+db_id;null==localStorage.getItem(ls_item)||"undefined"==localStorage.getItem(ls_item)?$.ajax({url:url,type:"GET",dataType:"json",success:function(data){localStorage.setItem("book"+db_id,JSON.stringify(data)),bookShow(_this,ls_item)}}):bookShow(_this,ls_item)}}}))})),$(".to-top").toTop({autohide:!0,offset:420,speed:500,position:!0,right:15,bottom:30});